@startuml LMS_Entity_Relationship_Diagram

' ========================================
' LMS - Complete Entity Relationship Diagram
' ========================================

!define PRIMARY_KEY <u>
!define FOREIGN_KEY <i>

' ========================================
' CORE USER MANAGEMENT
' ========================================

entity "User" as user {
  PRIMARY_KEY id : String (CUID)
  --
  name : String
  firstName : String?
  middleName : String?
  lastName : String?
  email : String? <<unique>>
  phone : String? <<unique>>
  symbolNo : String? <<unique>>
  school : String?
  department : String?
  experience : String?
  role : Enum(ADMIN, TEACHER, STUDENT)
  password : String?
  profileImage : String?
  verified : Boolean
  isActive : Boolean
  isBlocked : Boolean
  blockReason : String?
  blockedBy : String?
  blockedAt : DateTime?
  lastLogin : DateTime?
  FOREIGN_KEY batchId : String?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Profile" as profile {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY userId : String <<unique>>
  --
  address : String?
  dateOfBirth : DateTime?
  guardianName : String?
  guardianPhone : String?
  emergencyContact : String?
  bloodGroup : String?
  admissionDate : DateTime?
  rollNumber : String?
  classSection : String?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "AdminSession" as admin_session {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY userId : String
  --
  token : String <<unique>>
  refreshToken : String? <<unique>>
  ipAddress : String?
  userAgent : String?
  expiresAt : DateTime
  --
  createdAt : DateTime
  updatedAt : DateTime
}

' ========================================
' ACADEMIC STRUCTURE
' ========================================

entity "Class" as class {
  PRIMARY_KEY id : String (CUID)
  --
  name : String <<unique>>
  section : String?
  description : String?
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Subject" as subject {
  PRIMARY_KEY id : String (CUID)
  --
  name : String <<unique>>
  code : String? <<unique>>
  description : String?
  color : String?
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "TeacherClass" as teacher_class {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY teacherId : String
  FOREIGN_KEY classId : String
  FOREIGN_KEY subjectId : String
  --
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (teacherId, classId, subjectId)
}

entity "StudentClass" as student_class {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY classId : String
  --
  isActive : Boolean
  enrolledAt : DateTime
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (studentId, classId)
}

' ========================================
' BATCH & GRADUATION SYSTEM
' ========================================

entity "Batch" as batch {
  PRIMARY_KEY id : String (CUID)
  --
  name : String <<unique>>
  description : String?
  startYear : Int
  endYear : Int
  startDate : DateTime
  endDate : DateTime?
  status : Enum(PLANNING, ACTIVE, COMPLETED, GRADUATED, ARCHIVED)
  maxStudents : Int?
  currentStudents : Int
  FOREIGN_KEY createdBy : String
  --
  createdAt : DateTime
  updatedAt : DateTime
  completedAt : DateTime?
  graduatedAt : DateTime?
}

entity "ClassBatch" as class_batch {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY classId : String
  FOREIGN_KEY batchId : String
  --
  sequence : Int
  isActive : Boolean
  startDate : DateTime
  endDate : DateTime?
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (classId, batchId)
}

entity "ClassEnrollment" as class_enrollment {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY classId : String
  FOREIGN_KEY batchId : String
  FOREIGN_KEY enrolledBy : String
  --
  enrolledAt : DateTime
  completedAt : DateTime?
  isCompleted : Boolean
  isPassed : Boolean?
  finalGrade : Enum(Grade)?
  finalMarks : Float?
  totalMarks : Float?
  attendance : Float?
  remarks : String?
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (studentId, classId, batchId)
}

entity "Graduation" as graduation {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY batchId : String
  FOREIGN_KEY studentId : String
  FOREIGN_KEY createdBy : String
  --
  graduatedAt : DateTime
  graduationDate : DateTime
  overallGrade : Enum(Grade)?
  overallPercentage : Float?
  totalCredits : Float?
  cgpa : Float?
  certificateNo : String? <<unique>>
  certificateUrl : String?
  isAwarded : Boolean
  awardedAt : DateTime?
  remarks : String?
  honors : String?
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (batchId, studentId)
}

' ========================================
' MODULE/SUBJECT LEARNING SYSTEM
' ========================================

entity "Module" as module {
  PRIMARY_KEY id : String (CUID)
  --
  title : String
  slug : String <<unique>>
  description : String?
  FOREIGN_KEY subjectId : String
  FOREIGN_KEY classId : String?
  FOREIGN_KEY teacherId : String
  thumbnailUrl : String?
  level : String (BEGINNER/INTERMEDIATE/ADVANCED)
  duration : Int?
  totalTopics : Int
  totalLessons : Int
  status : Enum(ModuleStatus)
  isFeatured : Boolean
  isPublic : Boolean
  viewCount : Int
  enrollmentCount : Int
  avgRating : Float?
  publishedAt : DateTime?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Topic" as topic {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY moduleId : String
  --
  title : String
  description : String?
  orderIndex : Int
  duration : Int?
  totalLessons : Int
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Lesson" as lesson {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY topicId : String
  --
  title : String
  description : String?
  type : Enum(VIDEO, YOUTUBE_LIVE, PDF, TEXT, QUIZ, ASSIGNMENT, EXTERNAL_LINK)
  orderIndex : Int
  duration : Int?
  videoUrl : String?
  youtubeVideoId : String?
  content : String?
  isFree : Boolean
  isPublished : Boolean
  viewCount : Int
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "LessonAttachment" as lesson_attachment {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY lessonId : String
  --
  title : String
  fileName : String
  fileUrl : String
  fileSize : Int?
  fileType : String?
  downloadCount : Int
  --
  createdAt : DateTime
}

entity "YoutubeLiveSession" as youtube_live {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY lessonId : String <<unique>>
  --
  youtubeUrl : String
  youtubeLiveId : String?
  scheduledStartTime : DateTime
  scheduledEndTime : DateTime
  actualStartTime : DateTime?
  actualEndTime : DateTime?
  isLive : Boolean
  recordingUrl : String?
  maxViewers : Int?
  currentViewers : Int
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "ModuleEnrollment" as module_enrollment {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY moduleId : String
  FOREIGN_KEY studentId : String
  FOREIGN_KEY enrolledBy : String
  --
  enrolledAt : DateTime
  completedAt : DateTime?
  progress : Float (0-100)
  lastAccessedAt : DateTime?
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (moduleId, studentId)
}

entity "TopicProgress" as topic_progress {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY enrollmentId : String
  FOREIGN_KEY topicId : String
  FOREIGN_KEY studentId : String
  --
  completedLessons : Int
  totalLessons : Int
  progress : Float (0-100)
  isCompleted : Boolean
  completedAt : DateTime?
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (enrollmentId, topicId)
}

entity "LessonProgress" as lesson_progress {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY lessonId : String
  FOREIGN_KEY studentId : String
  FOREIGN_KEY enrollmentId : String
  --
  isCompleted : Boolean
  completedAt : DateTime?
  watchTime : Int?
  lastPosition : Int?
  attemptsCount : Int?
  score : Float?
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (lessonId, studentId)
}

entity "LessonNote" as lesson_note {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY lessonId : String
  FOREIGN_KEY studentId : String
  --
  content : String
  timestamp : Int?
  isPinned : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "ModuleReview" as module_review {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY moduleId : String
  FOREIGN_KEY studentId : String
  --
  rating : Int (1-5)
  comment : String?
  isPublished : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (moduleId, studentId)
}

entity "ActivityHistory" as activity_history {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY userId : String
  FOREIGN_KEY moduleId : String?
  FOREIGN_KEY topicId : String?
  FOREIGN_KEY lessonId : String?
  --
  activityType : Enum(ActivityType)
  title : String
  description : String?
  metadata : Json?
  ipAddress : String?
  userAgent : String?
  timestamp : DateTime
}

' ========================================
' RESOURCE SYSTEM
' ========================================

entity "ModuleResource" as module_resource {
  PRIMARY_KEY id : String (CUID)
  --
  title : String
  description : String?
  category : Enum(ResourceCategory)
  tags : String[]
  type : Enum(ResourceType)
  fileUrl : String?
  fileName : String?
  fileSize : Int?
  mimeType : String?
  externalUrl : String?
  FOREIGN_KEY moduleId : String?
  FOREIGN_KEY topicId : String?
  FOREIGN_KEY lessonId : String?
  status : Enum(ResourceStatus)
  isHidden : Boolean
  visibleToRoles : String[]
  orderIndex : Int
  version : Int
  isPinned : Boolean
  isMandatory : Boolean
  viewCount : Int
  downloadCount : Int
  FOREIGN_KEY uploadedBy : String
  publishedAt : DateTime?
  archivedAt : DateTime?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "ResourceAccessLog" as resource_access_log {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY resourceId : String
  FOREIGN_KEY userId : String
  --
  action : String (VIEW, DOWNLOAD, EDIT, DELETE)
  ipAddress : String?
  userAgent : String?
  metadata : Json?
  timestamp : DateTime
}

' ========================================
' LIVE CLASS SYSTEM
' ========================================

entity "LiveClass" as live_class {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY teacherId : String
  FOREIGN_KEY classId : String
  FOREIGN_KEY subjectId : String
  FOREIGN_KEY moduleId : String?
  --
  title : String
  description : String?
  youtubeUrl : String?
  meetingLink : String?
  startTime : DateTime
  endTime : DateTime?
  status : Enum(LiveClassStatus)
  isRecorded : Boolean
  recordingUrl : String?
  maxStudents : Int?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Attendance" as attendance {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY liveClassId : String
  --
  joinedAt : DateTime
  leftAt : DateTime?
  duration : Int?
  isPresent : Boolean
  --
  createdAt : DateTime
  --
  <<unique>> (studentId, liveClassId)
}

' ========================================
' CONTENT & MATERIALS
' ========================================

entity "Material" as material {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY subjectId : String
  FOREIGN_KEY teacherId : String
  --
  title : String
  description : String?
  type : Enum(MaterialType)
  fileUrl : String?
  fileName : String?
  fileSize : Int?
  chapter : String?
  isPublic : Boolean
  downloadCount : Int
  uploadedAt : DateTime
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "MaterialAccessLog" as material_access_log {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY materialId : String
  --
  viewedAt : DateTime?
  downloadedAt : DateTime?
  ipAddress : String?
  --
  createdAt : DateTime
}

' ========================================
' ROUTINE & SCHEDULING
' ========================================

entity "Routine" as routine {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY classId : String
  FOREIGN_KEY subjectId : String
  FOREIGN_KEY teacherId : String
  FOREIGN_KEY createdBy : String
  --
  dayOfWeek : Enum(DayOfWeek)
  startTime : String
  endTime : String
  room : String?
  isActive : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (classId, subjectId, dayOfWeek, startTime)
}

' ========================================
' NOTICE & COMMUNICATION
' ========================================

entity "Notice" as notice {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY classId : String?
  FOREIGN_KEY publishedBy : String
  --
  title : String
  content : String
  category : Enum(NoticeCategory)
  priority : Enum(Priority)
  attachmentUrl : String?
  isPublished : Boolean
  publishedAt : DateTime?
  expiresAt : DateTime?
  viewCount : Int
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "Notification" as notification {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY senderId : String?
  FOREIGN_KEY receiverId : String
  --
  title : String
  message : String
  type : Enum(NotificationType)
  data : Json?
  isRead : Boolean
  readAt : DateTime?
  sentAt : DateTime
  --
  createdAt : DateTime
}

entity "Message" as message {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY senderId : String
  FOREIGN_KEY receiverId : String?
  FOREIGN_KEY classId : String?
  FOREIGN_KEY replyToId : String?
  --
  content : String
  attachmentUrl : String?
  isRead : Boolean
  readAt : DateTime?
  isDeleted : Boolean
  timestamp : DateTime
  --
  createdAt : DateTime
}

' ========================================
' EXAM & ASSESSMENT
' ========================================

entity "Exam" as exam {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY subjectId : String
  FOREIGN_KEY classId : String?
  FOREIGN_KEY createdBy : String
  --
  title : String
  description : String?
  type : Enum(ExamType)
  status : Enum(ExamStatus)
  examLink : String?
  startTime : DateTime
  endTime : DateTime
  duration : Int?
  totalMarks : Int?
  passingMarks : Int?
  instructions : String?
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "ExamSubmission" as exam_submission {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY examId : String
  --
  submittedAt : DateTime
  answers : Json?
  ipAddress : String?
  userAgent : String?
  isLate : Boolean
  --
  createdAt : DateTime
  --
  <<unique>> (studentId, examId)
}

entity "Result" as result {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY examId : String
  FOREIGN_KEY subjectId : String
  --
  marks : Float
  totalMarks : Float
  percentage : Float
  grade : Enum(Grade)?
  remarks : String?
  isPublished : Boolean
  publishedAt : DateTime?
  --
  createdAt : DateTime
  updatedAt : DateTime
  --
  <<unique>> (studentId, examId, subjectId)
}

entity "Certificate" as certificate {
  PRIMARY_KEY id : String (CUID)
  FOREIGN_KEY studentId : String
  FOREIGN_KEY examId : String?
  --
  title : String
  description : String?
  pdfUrl : String
  templateId : String?
  serialNumber : String <<unique>>
  issuedDate : DateTime
  isValid : Boolean
  generatedAt : DateTime
  --
  createdAt : DateTime
}

' ========================================
' SYSTEM & AUDIT
' ========================================

entity "ActivityLog" as activity_log {
  PRIMARY_KEY id : String (CUID)
  --
  userId : String
  performedBy : String?
  action : String
  entity : String?
  entityId : String?
  details : Json?
  notes : String?
  ipAddress : String?
  userAgent : String?
  timestamp : DateTime
}

entity "SystemSettings" as system_settings {
  PRIMARY_KEY id : String (CUID)
  --
  key : String <<unique>>
  value : String
  description : String?
  isPublic : Boolean
  --
  createdAt : DateTime
  updatedAt : DateTime
}

entity "FileUpload" as file_upload {
  PRIMARY_KEY id : String (CUID)
  --
  originalName : String
  fileName : String <<unique>>
  mimeType : String
  size : Int
  path : String
  uploadedBy : String
  entityType : String?
  entityId : String?
  isPublic : Boolean
  --
  createdAt : DateTime
}

' ========================================
' RELATIONSHIPS
' ========================================

' User Relations
user ||--o| profile : "has"
user ||--o{ admin_session : "has sessions"
user ||--o{ teacher_class : "teaches"
user ||--o{ student_class : "enrolled in"
user }o--|| batch : "belongs to"
user ||--o{ class_enrollment : "class enrollments"
user ||--o{ graduation : "graduated"
user ||--o{ module : "creates"
user ||--o{ module_enrollment : "enrolls in"
user ||--o{ topic_progress : "tracks"
user ||--o{ lesson_progress : "tracks"
user ||--o{ lesson_note : "writes"
user ||--o{ module_review : "reviews"
user ||--o{ activity_history : "performs"
user ||--o{ module_resource : "uploads"
user ||--o{ resource_access_log : "accesses"
user ||--o{ live_class : "teaches"
user ||--o{ attendance : "attends"
user ||--o{ material : "uploads"
user ||--o{ material_access_log : "accesses"
user ||--o{ routine : "schedules"
user ||--o{ notice : "publishes"
user ||--o{ notification : "sends/receives"
user ||--o{ message : "sends/receives"
user ||--o{ exam : "creates"
user ||--o{ exam_submission : "submits"
user ||--o{ result : "receives"
user ||--o{ certificate : "receives"
user ||--o{ batch : "creates"

' Academic Structure
class ||--o{ teacher_class : "has teachers"
class ||--o{ student_class : "has students"
class ||--o{ class_batch : "in batches"
class ||--o{ class_enrollment : "enrollments"
class ||--o{ module : "has modules"
class ||--o{ live_class : "has live classes"
class ||--o{ routine : "has schedule"
class ||--o{ notice : "receives notices"
class ||--o{ exam : "has exams"
class ||--o{ message : "receives messages"

subject ||--o{ teacher_class : "taught by"
subject ||--o{ module : "has modules"
subject ||--o{ live_class : "taught in"
subject ||--o{ material : "has materials"
subject ||--o{ routine : "scheduled"
subject ||--o{ exam : "has exams"
subject ||--o{ result : "has results"

teacher_class }o--|| user : "teacher"
teacher_class }o--|| class : "class"
teacher_class }o--|| subject : "subject"

student_class }o--|| user : "student"
student_class }o--|| class : "class"

' Batch System
batch ||--o{ class_batch : "contains classes"
batch ||--o{ user : "has students"
batch ||--o{ class_enrollment : "has enrollments"
batch ||--o{ graduation : "graduates"

class_batch }o--|| class : "class"
class_batch }o--|| batch : "batch"

class_enrollment }o--|| user : "student"
class_enrollment }o--|| class : "class"
class_enrollment }o--|| batch : "batch"

graduation }o--|| batch : "from batch"
graduation }o--|| user : "student"

' Module System
module ||--o{ topic : "has topics"
module }o--|| subject : "belongs to"
module }o--|| class : "taught in"
module }o--|| user : "created by"
module ||--o{ module_enrollment : "enrollments"
module ||--o{ module_review : "reviews"
module ||--o{ activity_history : "activities"
module ||--o{ module_resource : "has resources"
module ||--o{ live_class : "has live classes"

topic ||--o{ lesson : "has lessons"
topic }o--|| module : "belongs to"
topic ||--o{ topic_progress : "progress"
topic ||--o{ activity_history : "activities"
topic ||--o{ module_resource : "has resources"

lesson }o--|| topic : "belongs to"
lesson ||--o{ lesson_attachment : "has attachments"
lesson ||--o| youtube_live : "live session"
lesson ||--o{ lesson_progress : "progress"
lesson ||--o{ lesson_note : "has notes"
lesson ||--o{ activity_history : "activities"
lesson ||--o{ module_resource : "has resources"

module_enrollment }o--|| module : "module"
module_enrollment }o--|| user : "student"
module_enrollment ||--o{ topic_progress : "tracks topics"
module_enrollment ||--o{ lesson_progress : "tracks lessons"

topic_progress }o--|| module_enrollment : "enrollment"
topic_progress }o--|| topic : "topic"
topic_progress }o--|| user : "student"

lesson_progress }o--|| lesson : "lesson"
lesson_progress }o--|| user : "student"
lesson_progress }o--|| module_enrollment : "enrollment"

lesson_note }o--|| lesson : "lesson"
lesson_note }o--|| user : "student"

module_review }o--|| module : "module"
module_review }o--|| user : "student"

' Resource System
module_resource }o--o| module : "attached to"
module_resource }o--o| topic : "attached to"
module_resource }o--o| lesson : "attached to"
module_resource }o--|| user : "uploaded by"
module_resource ||--o{ resource_access_log : "access logs"

resource_access_log }o--|| module_resource : "resource"
resource_access_log }o--|| user : "user"

' Live Class
live_class }o--|| user : "teacher"
live_class }o--|| class : "class"
live_class }o--|| subject : "subject"
live_class }o--o| module : "module"
live_class ||--o{ attendance : "attendance"

attendance }o--|| user : "student"
attendance }o--|| live_class : "live class"

' Material
material }o--|| subject : "subject"
material }o--|| user : "teacher"
material ||--o{ material_access_log : "access logs"

material_access_log }o--|| user : "student"
material_access_log }o--|| material : "material"

' Routine
routine }o--|| class : "class"
routine }o--|| subject : "subject"
routine }o--|| user : "teacher"

' Notice & Communication
notice }o--o| class : "for class"
notice }o--|| user : "published by"

notification }o--o| user : "sender"
notification }o--|| user : "receiver"

message }o--|| user : "sender"
message }o--o| user : "receiver"
message }o--o| class : "to class"
message }o--o| message : "reply to"

' Exam System
exam }o--|| subject : "subject"
exam }o--o| class : "class"
exam }o--|| user : "created by"
exam ||--o{ exam_submission : "submissions"
exam ||--o{ result : "results"
exam ||--o{ certificate : "certificates"

exam_submission }o--|| user : "student"
exam_submission }o--|| exam : "exam"

result }o--|| user : "student"
result }o--|| exam : "exam"
result }o--|| subject : "subject"

certificate }o--|| user : "student"
certificate }o--o| exam : "exam"

@enduml
